<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;python&quot;,&quot;ruby&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="ruby">ruby</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://www.nifty.co.ke/users/register/'>Sign Up for a Developer Key</a></li>
            <li><a href='https://www.east36.co.ke'>An East36 Service</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the Nifty API! You can use our API to access Nifty Payment API endpoints, which can get information on transactions and events related to your wallet.</p>

<p>We have language bindings in Ruby and Python! You can view code examples in the dark area to the right, and you can switch the programming language of the examples with the tabs in the top right.</p>

<p>To proceed,</p>

<ol>
<li><a href='https://www.nifty.co.ke/users/register/'>Sign up</a> for an account. You will need to validate your email account and mobile phone number.</li>
<li>Navigate to your profile and create an API Key. Save the secret key somewhere safe since we will not show it again.</li>
<li>Install your language specific Nifty api client.</li>
<li>Configure your client with your API access key, secret key and user id.</li>
<li>Make calls</li>
</ol>

<h2 id="transport-security">Transport security</h2>

<p>All API requests to us should be made over HTTPS and be signed. This provides us with certain guarantees that:</p>

<ol>
<li>You made the API call.</li>
<li>The API call has not been tampered with.</li>
<li>The API call is not a replay attack.</li>
<li>Your API call was visible to you and us only.</li>
</ol>

<p>To ensure that will always be true,</p>

<ol>
<li>Rotate your keys frequently.</li>
<li>Conduct (or let your client) ssl certificate verification.</li>
<li>Use NTP/Time servers to ensure that your api callers have the correct time.</li>
</ol>

<aside class="notice">
To achieve all of this in a dead simple way, just use our api client libraries.
</aside>

<p>Unfortunately, this means that shell access is a bit clunky due to signature generation.</p>

<h2 id="notes">Notes</h2>

<p>All API calls will return:</p>

<ol>
<li>Timezone aware dates in iso8601 format.</li>
<li>Unicode strings when the data is unicode.</li>
<li>Transaction values in 2 decimal places.</li>
</ol>

<p>We expect the reverse to be true. For example, if you wish to query for transactions between two time instants, provide a timezone aware iso8601 timestamp.</p>

<h1 id="client-initialisation">Client Initialisation</h1>

<blockquote>
<p>To initialise, use this code:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">nifty_client</span> <span class="kn">import</span> <span class="n">NiftyWalletClient</span>

<span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="n">key_id</span> <span class="o">=</span> <span class="s">"e51cab9a86a9d045e3aea24dbca34536"</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="s">"97224b6b736913ba612904da65022f5ec64c1a8906224654be068cace859d7dfb73ece0810f691d8072d36a62f708bc6"</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="s">"8dad2dea-7d7f-4e8b-a61c-53150f1b7452"</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">NiftyWalletClient</span><span class="p">(</span><span class="n">Config</span><span class="p">(),</span> <span class="n">logger</span><span class="p">)</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'niftyclient'</span>

<span class="n">client</span> <span class="o">=</span> <span class="no">Nifty</span><span class="o">::</span><span class="no">APIClient</span><span class="p">.</span><span class="nf">initialise!</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">access_key</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Make sure to replace <code class="prettyprint">user_id</code>, <code class="prettyprint">access_key</code>, and <code class="prettyprint">secret_key</code> with your API details from the API tab on the dashboard.</p>
</blockquote>

<p>Nifty clients use API keys to allow access to the API. You can register for your API key at our <a href="https://www.nifty.co.ke/users/profile#tab_api_settings">developer portal</a>.</p>

<p>Once you initialise your client, the api payload HMAC will be included in all API requests to the server in a header that looks like the following:</p>

<p><code class="prettyprint">Authorization: &#39;Signature headers=&quot;date (request-target) host content-length content-type x-content-sha256&quot;,keyId=&quot;e51cab9a86a9d045e3aea24dbca34536&quot;,algorithm=&quot;hmac-sha256&quot;,signature=&quot;iB2uqBBjVXIzVcV3jeZTGpnhQ1yTz3AnpT/JAcLzVKw=&quot;&#39;</code></p>

<p>For POST and PUT, the payload will HMAC&rsquo;d and the checksum will be included in a header similar to:</p>

<p><code class="prettyprint">x-content-sha256: &#39;bvVpDJi7jhDkudLoYg09WtyEHnnyYDeldRHFsvuJKCk=&#39;</code></p>

<aside class="notice">
You must replace  provide a valid set of user id, access key and secret key. Not doing so result in a HTTP 403 response with the payload
<code>
{
    "message": "Access denied"
}
</code>.
</aside>

<h1 id="wallet">Wallet</h1>

<h2 id="get-all-wallets">Get All Wallets</h2>
<pre class="highlight python tab-python"><code><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_wallet</span><span class="p">()</span>
<span class="n">wallet_response</span> <span class="o">=</span> <span class="n">response</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="n">wallet_response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">wallet</span><span class="p">.</span><span class="nf">get</span>
</code></pre>
<blockquote>
<p>The above command returns an object wrapping the response and can be accessed as shown below:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="n">wallet_response</span><span class="o">.</span><span class="n">available_resultset_size</span>
<span class="n">wallet</span> <span class="o">=</span> <span class="n">wallet_response</span><span class="o">.</span><span class="n">wallets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">wallet</span><span class="o">.</span><span class="n">balance</span>
</code></pre>
<blockquote>
<p>JSON dump of available fields in a wallet.</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="s2">"user_name"</span><span class="p">:</span><span class="s2">"mike"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"created_at"</span><span class="p">:</span><span class="s2">"2017-04-24T23:33:52.747695+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"balance"</span><span class="p">:</span><span class="s2">"1645.46"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user_id"</span><span class="p">:</span><span class="s2">"8dad2dea-7d7f-4e8b-a61c-53150f1b7452"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"last_modified"</span><span class="p">:</span><span class="s2">"2017-04-25T00:12:36.050071+03:00"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This endpoint retrieves all your wallets. If you don&rsquo;t have a wallet, you will get a response with an empty json list. Just issue the create wallet call to create one.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://api.nifty.co.ke/api/v1/user/&lt;uuid:user_id&gt;/wallet</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<p>None</p>

<h2 id="create-a-wallet">Create A Wallet</h2>
<pre class="highlight python tab-python"><code><span class="n">wallet_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_wallet</span><span class="p">()</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="n">wallet_response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">wallet</span><span class="p">.</span><span class="nf">create</span>
</code></pre>
<blockquote>
<p>The above command returns an object wrapping the response and can be accessed as shown below:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="n">wallet_response</span><span class="o">.</span><span class="n">available_resultset_size</span>
<span class="n">wallet</span> <span class="o">=</span> <span class="n">wallet_response</span><span class="o">.</span><span class="n">wallets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">wallet</span><span class="o">.</span><span class="n">balance</span>
</code></pre>
<blockquote>
<p>JSON dump of available fields in a wallet.</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="s2">"user_name"</span><span class="p">:</span><span class="s2">"mike"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"created_at"</span><span class="p">:</span><span class="s2">"2017-04-24T23:33:52.747695+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"balance"</span><span class="p">:</span><span class="s2">"1645.46"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user_id"</span><span class="p">:</span><span class="s2">"8dad2dea-7d7f-4e8b-a61c-53150f1b7452"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"last_modified"</span><span class="p">:</span><span class="s2">"2017-04-25T00:12:36.050071+03:00"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This endpoint creates a wallet.</p>

<aside class="notice">This operation is idempotent and can be safely called multiple times.</aside>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST http://api.nifty.co.ke/api/v1/user/&lt;uuid:user_id&gt;/wallet</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<p>None</p>

<h1 id="mpesa-c2b">MPESA C2B</h1>

<h2 id="consume-a-token">Consume A Token</h2>
<pre class="highlight python tab-python"><code><span class="n">token_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">consume_token</span><span class="p">(</span> 
                <span class="n">transaction_id</span><span class="o">=</span><span class="s">"7BMKZ6K7E8"</span><span class="p">,</span> <span class="n">phone_number</span><span class="o">=</span><span class="s">"254716622448"</span><span class="p">,</span> <span class="n">till_number</span><span class="o">=</span><span class="mi">703648</span><span class="p">)</span>

</code></pre><pre class="highlight ruby tab-ruby"><code><span class="n">token_response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">wallet</span><span class="p">.</span><span class="nf">consume_token</span><span class="p">(</span>
                <span class="n">transaction_id</span><span class="o">=</span><span class="s2">"7BMKZ6K7E8"</span><span class="p">,</span> <span class="n">phone_number</span><span class="o">=</span><span class="s2">"254716622448"</span><span class="p">,</span> <span class="n">till_number</span><span class="o">=</span><span class="mi">703648</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>The above command returns an object wrapping the response and can be accessed as shown below:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="n">token_response</span><span class="o">.</span><span class="n">available_resultset_size</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">token_response</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">token</span><span class="o">.</span><span class="n">trans_amount</span>
</code></pre>
<blockquote>
<p>JSON dump of available fields in a token</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="s2">"d2c29c60-0b1a-11e7-8f7b-061cf2e0e94d"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"till_number"</span><span class="p">:</span><span class="s2">"703648"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user_id"</span><span class="p">:</span><span class="s2">"8dad2dea-7d7f-4e8b-a61c-53150f1b7452"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_amount"</span><span class="p">:</span><span class="s2">"581.37"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="s2">"254722123456"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_time"</span><span class="p">:</span><span class="s2">"2017-01-24T21:30:52.739243+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"last_modified"</span><span class="p">:</span><span class="s2">"2017-01-24T21:30:52.739243+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"names"</span><span class="p">:</span><span class="s2">"First M Last"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_id"</span><span class="p">:</span><span class="s2">"0OZC02Q1OZ"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This endpoint consumes a token and credits your wallet with the token amount.</p>

<aside class="notice">This operation is not idempotent and cannot be safely called multiple times. However, in case of failure, use the transactions list api to refetch the call result.</aside>

<aside class="success">If successful, this call will credit your account with the token value</aside>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">PUT http://api.nifty.co.ke/api/v1/user/&lt;uuid:user_id&gt;/wallet</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>transaction_id</td>
<td>The unique token identifier (Ex: MPESA transaction code or Airtel Money transaction ID).</td>
</tr>
<tr>
<td>phone_number</td>
<td>The phone number of the user who executed the money transfer (Ex: Phone Number of MPESA sender).</td>
</tr>
<tr>
<td>till_number</td>
<td>The till number the user sent the money to. Please note that for Safaricom MPESA, this will correspond to the store_number. Use the till tab, on your profile page on the dashboard to get the correct value to use here.</td>
</tr>
</tbody></table>

<h2 id="view-transactions">View Transactions</h2>
<pre class="highlight python tab-python"><code><span class="n">transaction_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">transactions</span><span class="p">()</span>

</code></pre><pre class="highlight ruby tab-ruby"><code><span class="n">transaction_response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">wallet</span><span class="p">.</span><span class="nf">transactions</span>
</code></pre>
<blockquote>
<p>The above command returns an object wrapping the response and can be accessed as shown below:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="n">transaction_response</span><span class="o">.</span><span class="n">available_resultset_size</span>
<span class="n">transaction</span> <span class="o">=</span> <span class="n">transaction_response</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">transaction</span><span class="o">.</span><span class="n">trans_amount</span>
</code></pre>
<blockquote>
<p>JSON dump of available fields in a transaction</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="s2">"d2c29c60-0b1a-11e7-8f7b-061cf2e0e94d"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"till_number"</span><span class="p">:</span><span class="s2">"703648"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"last_modified"</span><span class="p">:</span><span class="s2">"2016-11-04T21:30:52.739569+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user_id"</span><span class="p">:</span><span class="s2">"15695297-f441-4b1c-a75b-831fbb1d1431"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"names"</span><span class="p">:</span><span class="s2">"First M Last"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="s2">"254722123456"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_time"</span><span class="p">:</span><span class="s2">"2016-11-04T21:30:52.739569+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_id"</span><span class="p">:</span><span class="s2">"DZ56D1KDZG"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_amount"</span><span class="p">:</span><span class="s2">"250.02"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="s2">"d2c29c60-0b1a-11e7-8f7b-061cf2e0e94d"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"till_number"</span><span class="p">:</span><span class="s2">"703648"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"last_modified"</span><span class="p">:</span><span class="s2">"2016-11-10T21:30:52.739705+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user_id"</span><span class="p">:</span><span class="s2">"15695297-f441-4b1c-a75b-831fbb1d1431"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"names"</span><span class="p">:</span><span class="s2">"First M Last"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="s2">"254722123456"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_time"</span><span class="p">:</span><span class="s2">"2016-11-10T21:30:52.739705+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_id"</span><span class="p">:</span><span class="s2">"2ZS5XLSY3P"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_amount"</span><span class="p">:</span><span class="s2">"40.19"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="s2">"d2c29c60-0b1a-11e7-8f7b-061cf2e0e94d"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"till_number"</span><span class="p">:</span><span class="s2">"703648"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"last_modified"</span><span class="p">:</span><span class="s2">"2016-08-29T21:30:52.739833+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user_id"</span><span class="p">:</span><span class="s2">"15695297-f441-4b1c-a75b-831fbb1d1431"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"names"</span><span class="p">:</span><span class="s2">"First M Last"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="s2">"254722123456"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_time"</span><span class="p">:</span><span class="s2">"2016-08-29T21:30:52.739833+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_id"</span><span class="p">:</span><span class="s2">"7BMKZ6K7E8"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_amount"</span><span class="p">:</span><span class="s2">"276.40"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This endpoint lists the last 30 transactions made against your wallet. Use the limit and offset arguments to fetch paginated results.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://api.nifty.co.ke/api/v1/user/&lt;uuid:user_id&gt;/wallet/transactions</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>The maximum number of results to return in this call.</td>
</tr>
<tr>
<td>offset</td>
<td>Where to start the paginated result.</td>
</tr>
</tbody></table>

<h2 id="search-for-a-transaction">Search For A Transaction</h2>
<pre class="highlight python tab-python"><code><span class="n">transaction_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">transactions</span><span class="p">(</span><span class="n">transaction_id</span><span class="o">=</span><span class="s">'DZ56D1KDZG'</span><span class="p">)</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="n">transaction_response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">wallet</span><span class="p">.</span><span class="nf">transactions</span><span class="p">(</span><span class="n">transaction_id</span><span class="o">=</span><span class="s1">'DZ56D1KDZG'</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>The above command returns an object wrapping the response and can be accessed as shown below:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="n">transaction_response</span><span class="o">.</span><span class="n">available_resultset_size</span>
<span class="n">transaction</span> <span class="o">=</span> <span class="n">transaction_response</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">transaction</span><span class="o">.</span><span class="n">trans_amount</span>
</code></pre>
<blockquote>
<p>JSON dump of available fields in a transaction.</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="s2">"d2c29c60-0b1a-11e7-8f7b-061cf2e0e94d"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"till_number"</span><span class="p">:</span><span class="s2">"703648"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user_id"</span><span class="p">:</span><span class="s2">"8dad2dea-7d7f-4e8b-a61c-53150f1b7452"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_amount"</span><span class="p">:</span><span class="s2">"581.37"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="s2">"254716622448"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_time"</span><span class="p">:</span><span class="s2">"2017-01-24T21:30:52.739243+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"last_modified"</span><span class="p">:</span><span class="s2">"2017-01-24T21:30:52.739243+03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"names"</span><span class="p">:</span><span class="s2">"LABAN M KIMOTHO"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"trans_id"</span><span class="p">:</span><span class="s2">"0OZC02Q1OZ"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This endpoint lists the matching transactions found in your wallet.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://api.nifty.co.ke/api/v1/user/&lt;uuid:user_id&gt;/wallet/transactions</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>transaction_id</td>
<td>The id of the transaction token being looked up.</td>
</tr>
<tr>
<td>limit</td>
<td>The maximum number of results to return in this call.</td>
</tr>
<tr>
<td>offset</td>
<td>Where to start the paginated result.</td>
</tr>
</tbody></table>

<h1 id="mpesa-online-checkout">MPESA Online Checkout</h1>

<h2 id="payment-request">Payment Request</h2>
<pre class="highlight python tab-python"><code><span class="n">online_checkout_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">initiate_online_checkout</span><span class="p">(</span> 
                <span class="n">transaction_id</span><span class="o">=</span><span class="s">"7BMKZ6K7E8"</span><span class="p">,</span> <span class="n">phone_number</span><span class="o">=</span><span class="s">"254716622448"</span><span class="p">,</span> 
                <span class="n">transaction_amount</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">callback_url</span><span class="o">=</span><span class="s">"http://example.com"</span><span class="p">,</span> 
                <span class="n">service_reference_id</span><span class="o">=</span><span class="s">"shopping-cart"</span>
<span class="p">)</span>

</code></pre><pre class="highlight ruby tab-ruby"><code><span class="n">online_checkout_response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">mpesa</span><span class="p">.</span><span class="nf">initiate_online_checkout</span><span class="p">(</span>
                <span class="n">transaction_id</span><span class="o">=</span><span class="s2">"7BMKZ6K7E8"</span><span class="p">,</span> <span class="n">phone_number</span><span class="o">=</span><span class="s2">"254716622448"</span><span class="p">,</span> 
                <span class="n">transaction_amount</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">callback_url</span><span class="o">=</span><span class="s2">"http://example.com"</span><span class="p">,</span> 
                <span class="n">service_reference_id</span><span class="o">=</span><span class="s2">"shopping-cart"</span>
<span class="p">)</span>
</code></pre>
<blockquote>
<p>The above command returns an object wrapping the response and can be accessed as shown below:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="n">online_checkout_response</span><span class="o">.</span><span class="n">available_resultset_size</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">online_checkout_response</span><span class="o">.</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">token</span><span class="o">.</span><span class="n">transaction_amount</span>
</code></pre>
<blockquote>
<p>JSON dump of available fields in a response</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="s2">"callback_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.com"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"39064aea-61a5-11e7-b7aa-0800276aff64"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-07-05T17:13:11.235922+00:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"last_modified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-07-05T17:13:11.235922+00:00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"phone_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"254700000000"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service_reference_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shopping-cart"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PENDING"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"transaction_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200.00"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7BMKZ6K7E8"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ee65a7ce-574e-4054-b8a2-cb0171818d0d"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This endpoint calls MPESA and pops up a USSD request for MPESA PIN for the amount requested. If the pin is entered, the amount requested will be deducted from the subscriber.</p>

<aside class="notice">This operation is not idempotent and cannot be safely called multiple times. However, each requests includes a payment_id that can be used to query the transaction status</aside>

<aside class="success">If successful, this call will credit your account with the transaction value.</aside>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST http://api.nifty.co.ke/api/v1/user/&lt;uuid:user_id&gt;/mpesa/online-checkout</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>transaction_id</td>
<td>A unique identifier generated by the caller. For example, this may be the caller&rsquo;s shopping cart ID.</td>
</tr>
<tr>
<td>phone_number</td>
<td>The subscriber to request an online checkout for.</td>
</tr>
<tr>
<td>transaction_amount</td>
<td>The amount to request from the subscriber.</td>
</tr>
<tr>
<td>service_reference_id</td>
<td>A means for a merchant to group related transactions.</td>
</tr>
<tr>
<td>callback_url</td>
<td>Callback on the merchant&rsquo;s side that will be used for notifications once the transaction reaches a terminate state.</td>
</tr>
</tbody></table>

<h2 id="payment-status">Payment status</h2>

<h3 id="mike-fill-out-this">MIke fill out this</h3>

          <h1 id="errors">Errors</h1>

<p>The Nifty API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; Your request was incorrect</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; Your API key is wrong or you did not provide one</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The API call cannot be requested by you.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The specified resource was not found.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; The HTTP method is not allowed on this resource.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; You requested a format that isn&rsquo;t json</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests &ndash; You are being throttled! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="ruby">ruby</a>
          </div>
      </div>
    </div>
  </body>
</html>
